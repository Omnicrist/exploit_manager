import json
import util_marshal
from settings import Singleton


class CustomSubmitter(metaclass=Singleton):
    def __init__(self, settings, caller_globals):
        if settings.submit_protocol.upper() == 'CUSTOM':
            submitter_file = settings.custom_submitter_file
            with open(submitter_file, 'r') as f:
                serial = json.load(f)
            self.submitter = util_marshal.unserialize_submitter(serial, caller_globals)

    def submit(self, flag, target_url, team_token):
        return self.submitter(flag, target_url, team_token)
