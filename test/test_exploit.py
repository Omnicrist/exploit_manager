import random
import time
import re
import string
import util_marshal
import json


def test_exploit(_opponent):
    alphanum = list(string.digits + string.ascii_lowercase + string.ascii_uppercase)
    flag_str = "".join([random.choice(alphanum) for _ in range(25)])
    flag = "CCIT{" + flag_str + "}"
    flag_regex = "CCIT[{][0-9a-zA-Z]{25}[}]"
    res = random.choice([flag, "lol nope"])
    flags_found = re.findall(flag_regex, res)
    time.sleep(2)
    return flags_found


def simple_test(_opponent):
    return []


if __name__ == "__main__":
    opponents = ["10.10.17.1", "10.10.17.2"]
    service = "yet another service"
    serial = util_marshal.serialize_exploit(test_exploit, opponents, service)
    with open("../exploit.JSON", 'w') as f:
        json.dump(serial, f)
    serial = util_marshal.serialize_exploit(simple_test, opponents, service)
    with open("../simple_exploit.JSON", 'w') as f:
        json.dump(serial, f)
